<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Chat – TMD</title>
  <link rel="stylesheet" href="style.css" />
  <style>

    .chat-shell { min-height: calc(100vh - 120px); display:grid; place-items:center; padding:40px 16px;}
    .chat-placeholder{
      max-width:720px; width:100%; border:1px solid #E6ECF3; border-radius:12px; padding:32px;
      background:#F7F9FC; text-align:center;
    }
    .chat-placeholder h1{ margin:0 0 8px; font-size:24px; color:#0A192F;}
    .chat-placeholder p{ margin:0; color:#4A5A70;}


    .chat-card { max-width:720px; width:100%; border:1px solid #E6ECF3; border-radius:12px; background:#F7F9FC; }
    .chat-frame { width:100%; height:70vh; border:0; border-radius:12px; display:block; }
    .guard { text-align:center; color:#4A5A70; }
    .guard small { display:block; margin-top:12px; opacity:.8; }
  </style>
</head>
<body>
  <header id="navbar-container"></header>

  <main class="chat-shell">

    <div id="authGuard" class="chat-placeholder guard">
      <img src="icons/tmd-chatbot-icon-robot.svg" alt="Chatbot" width="56" height="56" style="vertical-align:middle; margin-bottom:12px;" />
      <h1>Checking your session…</h1>
      <p>Please wait while we verify your login.</p>
      <small>If you are not redirected automatically, you may need to sign in again.</small>
    </div>


    <div id="chatMount" class="chat-card" style="display:none;">
      <iframe
        id="pluginChat"
        title="TMD Chat"
        class="chat-frame"
        src=""
        allow="clipboard-read; clipboard-write">
      </iframe>
      <noscript>
        <div class="chat-placeholder" style="border:none; background:transparent;">
          <p>Please enable JavaScript to use the chatbot.</p>
        </div>
      </noscript>
    </div>
  </main>

  <footer class="container site-footer">
    <p>© 2025 The Managed Desk. Built in Australia. Hosted on AWS Sydney.</p>
  </footer>

  <script src="navbar.js"></script>

  <script type="module">
  import { PLUGIN_CHAT, goToPluginLogin, isPluginAuthed } from "./auth-plugin.js";

  async function init() {
    let ok = null;
    try {
      ok = await isPluginAuthed();  
    } catch { ok = null; }

    if (ok === false) {
      return goToPluginLogin("/chat.html");
    }
    if (!PLUGIN_CHAT) {
      return goToPluginLogin("/chat.html");
    }
    document.getElementById("pluginChat").src = PLUGIN_CHAT;
    document.getElementById("authGuard").style.display = "none";
    document.getElementById("chatMount").style.display = "block";
  }

  init();
</script>

    init();
  </script>
</body>
</html>


